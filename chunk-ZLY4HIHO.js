import{b as ct,d as dt,j as lt,k as pt}from"./chunk-2GXHVGCV.js";import{a as M,c as ft,e as vt}from"./chunk-VI3J2NXP.js";import{a as Ct,b as xt,l as _t}from"./chunk-YO7AN3VC.js";import{a as yt,b as bt}from"./chunk-P4ZKZCAW.js";import{h as ut,i as f,j as gt,l as v,n as l,o as ht,p as E}from"./chunk-NRJTNV2G.js";import{a as st,e as mt}from"./chunk-WNLJE6EU.js";import{h as ot}from"./chunk-HMJYS4Q7.js";import{Aa as Z,B as I,Ba as A,Ca as J,Cc as O,Db as T,Ea as x,Eb as g,F as Y,Gb as tt,I as G,Jb as et,Kb as h,Mb as V,Nb as j,Ob as c,Pb as m,Qb as z,Sb as U,T as H,Ub as k,Vb as d,W as N,Wb as it,Xb as at,_ as W,ab as K,ba as X,cb as s,dc as P,ea as o,ec as rt,fc as $,m as y,ma as b,na as C,nc as nt,ob as D,oc as F,pc as L,q as p,qb as S,ub as _,xa as q,z as Q}from"./chunk-4LE3JLCT.js";var Dt=["*"];var St=new X("MAT_CARD_CONFIG"),Mt=(()=>{class i{appearance;constructor(){let t=o(St,{optional:!0});this.appearance=t?.appearance||"raised"}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=D({type:i,selectors:[["mat-card"]],hostAttrs:[1,"mat-mdc-card","mdc-card"],hostVars:4,hostBindings:function(e,a){e&2&&tt("mat-mdc-card-outlined",a.appearance==="outlined")("mdc-card--outlined",a.appearance==="outlined")},inputs:{appearance:"appearance"},exportAs:["matCard"],ngContentSelectors:Dt,decls:1,vars:0,template:function(e,a){e&1&&(it(),at(0))},styles:['.mat-mdc-card{display:flex;flex-direction:column;box-sizing:border-box;position:relative;border-style:solid;border-width:0;background-color:var(--mdc-elevated-card-container-color, var(--mat-sys-surface-container-low));border-color:var(--mdc-elevated-card-container-color, var(--mat-sys-surface-container-low));border-radius:var(--mdc-elevated-card-container-shape, var(--mat-sys-corner-medium));box-shadow:var(--mdc-elevated-card-container-elevation, var(--mat-sys-level1))}.mat-mdc-card::after{position:absolute;top:0;left:0;width:100%;height:100%;border:solid 1px rgba(0,0,0,0);content:"";display:block;pointer-events:none;box-sizing:border-box;border-radius:var(--mdc-elevated-card-container-shape, var(--mat-sys-corner-medium))}.mat-mdc-card-outlined{background-color:var(--mdc-outlined-card-container-color, var(--mat-sys-surface));border-radius:var(--mdc-outlined-card-container-shape, var(--mat-sys-corner-medium));border-width:var(--mdc-outlined-card-outline-width, 1px);border-color:var(--mdc-outlined-card-outline-color, var(--mat-sys-outline-variant));box-shadow:var(--mdc-outlined-card-container-elevation, var(--mat-sys-level0))}.mat-mdc-card-outlined::after{border:none}.mdc-card__media{position:relative;box-sizing:border-box;background-repeat:no-repeat;background-position:center;background-size:cover}.mdc-card__media::before{display:block;content:""}.mdc-card__media:first-child{border-top-left-radius:inherit;border-top-right-radius:inherit}.mdc-card__media:last-child{border-bottom-left-radius:inherit;border-bottom-right-radius:inherit}.mat-mdc-card-actions{display:flex;flex-direction:row;align-items:center;box-sizing:border-box;min-height:52px;padding:8px}.mat-mdc-card-title{font-family:var(--mat-card-title-text-font, var(--mat-sys-title-large-font));line-height:var(--mat-card-title-text-line-height, var(--mat-sys-title-large-line-height));font-size:var(--mat-card-title-text-size, var(--mat-sys-title-large-size));letter-spacing:var(--mat-card-title-text-tracking, var(--mat-sys-title-large-tracking));font-weight:var(--mat-card-title-text-weight, var(--mat-sys-title-large-weight))}.mat-mdc-card-subtitle{color:var(--mat-card-subtitle-text-color, var(--mat-sys-on-surface));font-family:var(--mat-card-subtitle-text-font, var(--mat-sys-title-medium-font));line-height:var(--mat-card-subtitle-text-line-height, var(--mat-sys-title-medium-line-height));font-size:var(--mat-card-subtitle-text-size, var(--mat-sys-title-medium-size));letter-spacing:var(--mat-card-subtitle-text-tracking, var(--mat-sys-title-medium-tracking));font-weight:var(--mat-card-subtitle-text-weight, var(--mat-sys-title-medium-weight))}.mat-mdc-card-title,.mat-mdc-card-subtitle{display:block;margin:0}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle{padding:16px 16px 0}.mat-mdc-card-header{display:flex;padding:16px 16px 0}.mat-mdc-card-content{display:block;padding:0 16px}.mat-mdc-card-content:first-child{padding-top:16px}.mat-mdc-card-content:last-child{padding-bottom:16px}.mat-mdc-card-title-group{display:flex;justify-content:space-between;width:100%}.mat-mdc-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;margin-bottom:16px;object-fit:cover}.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-avatar~.mat-mdc-card-header-text .mat-mdc-card-title{line-height:normal}.mat-mdc-card-sm-image{width:80px;height:80px}.mat-mdc-card-md-image{width:112px;height:112px}.mat-mdc-card-lg-image{width:152px;height:152px}.mat-mdc-card-xl-image{width:240px;height:240px}.mat-mdc-card-subtitle~.mat-mdc-card-title,.mat-mdc-card-title~.mat-mdc-card-subtitle,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-title,.mat-mdc-card-header .mat-mdc-card-header-text .mat-mdc-card-subtitle,.mat-mdc-card-title-group .mat-mdc-card-title,.mat-mdc-card-title-group .mat-mdc-card-subtitle{padding-top:0}.mat-mdc-card-content>:last-child:not(.mat-mdc-card-footer){margin-bottom:0}.mat-mdc-card-actions-align-end{justify-content:flex-end}'],encapsulation:2,changeDetection:0})}return i})();var wt=(()=>{class i{static \u0275fac=function(e){return new(e||i)};static \u0275dir=S({type:i,selectors:[["","mat-card-image",""],["","matCardImage",""]],hostAttrs:[1,"mat-mdc-card-image","mdc-card__media"]})}return i})();var w=class{static scrollToTop(){window.scroll({top:0,left:0,behavior:"smooth"})}static isElementDisplayed(r){let t=document.getElementById(r);return t?window.getComputedStyle(t).display!=="none":(console.warn(`Element with id "${r}" not found.`),!1)}static composeImgSrc(r){return`data:image/jpeg;base64,${r}`}};var B=class{static olderThanNDays(r,t){let a=Math.abs(new Date().getTime()-new Date(r).getTime());return Math.ceil(a/(1e3*3600*24))>t}};var It=(()=>{class i{constructor(){this.http=o(st),this.sessionStore=o(ht),this.sessionQuery=o(E)}getArtPiecesObservable(){return this.itIsNeccesaryToFetch()?this.http.get(`${M.backendUrl}nfts-snapshot`).pipe(p(t=>t.success&&t.data?t.data:[]),N(t=>this.saveNftsLocally(t)),I(()=>this.sessionQuery.getArtPiecesObservable)):this.sessionQuery.getArtPiecesObservable}getArtPieceDescriptions(t){return this.http.get(`${M.backendUrl}descriptions/${t}`).pipe(p(e=>e.success&&e.data?e.data:null),I(()=>y(null)))}getNftByIdObservable(t){return this.sessionQuery.getArtPiecesObservable.pipe(p(e=>l.getNftById(t,e)))}getSameArtThanObservable(t){return this.getNftByIdObservable(t).pipe(Q(e=>!!e?.name),p(e=>l.getArtByTitle(e.name,this.sessionQuery.selectArtPieces)))}getNftLenghtByYear(t){return l.getNftLenghtByYear(t,this.sessionQuery.selectArtPieces)}getAvailableOptimalUrl(t){return this.getLocalCachedThumbnail(t.tokenId).pipe(H(e=>e?y(e):this.fetchRemoteThumbnail(t.tokenId).pipe(p(a=>a||t.image.thumbnailUrl||t.image.originalUrl))))}getLinks(t){return this.http.get(M.backendUrl+"vision/search/"+t).pipe(p(e=>e.success&&e.data?e.data:[]),I(()=>y([])))}saveNftsLocally(t){this.sessionStore.update({artPieces:t,lastArtPiecesUpdate:new Date})}getLocalCachedThumbnail(t){let e=this.sessionQuery.getThumbnailByTokenId(t);return y(e?w.composeImgSrc(e.thumbnail):null)}fetchRemoteThumbnail(t){return this.http.get(`${M.backendUrl}nft-thumbnails/${t}`).pipe(N(e=>{if(e.success&&e.data){let a=this.sessionQuery.getValue().imageCache;this.sessionStore.update({imageCache:[...a,e.data]})}}),p(e=>e.data?w.composeImgSrc(e.data?.thumbnail):null))}itIsNeccesaryToFetch(){return!this.sessionQuery.selectArtPieces.length||!this.sessionQuery.selectLastArtPiecesUpdate||B.olderThanNDays(this.sessionQuery.selectLastArtPiecesUpdate,7)}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=W({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var At=(()=>{class i{constructor(){this.el=o(J),this.visible=new q,this.observer=new IntersectionObserver(t=>{t.forEach(e=>{e.isIntersecting&&(this.visible.emit(),this.observer.unobserve(this.el.nativeElement))})},{threshold:.1})}ngOnInit(){this.observer.observe(this.el.nativeElement)}ngOnDestroy(){this.observer.disconnect()}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275dir=S({type:i,selectors:[["","appLazyLoad",""]],outputs:{visible:"visible"}})}}return i})();var Tt=i=>({container:i});function kt(i,r){return this.methodTracking(r)}function Pt(i,r){if(i&1&&(c(0,"mat-icon"),P(1),m()),i&2){let t=d(3);s(),$(" ",t.sortOrder()==="asc"?"arrow_upward":"arrow_downward"," ")}}function Ft(i,r){if(i&1){let t=U();c(0,"mat-chip",6),F(1,"translate"),F(2,"translate"),k("click",function(){let a=b(t).$implicit,n=d(2);return C(n.changeSortMethod(a))}),c(3,"mat-icon"),P(4),m(),_(5,Pt,2,1,"mat-icon"),m()}if(i&2){let t=r.$implicit,e=d(2);g("matTooltip",`${L(1,4,"sortBy")} ${t}`),T("aria-label",`${L(2,6,"sortBy")} ${t}`),s(4),$(" ",t==="year"?"calendar_today":t==="medium"?"palette":"crop_free"," "),s(),h(e.activeSortMethod()===t?5:-1)}}function Lt(i,r){if(i&1&&(c(0,"mat-chip",5),F(1,"translate"),z(2,"app-pdf-button",7),m()),i&2){let t=d(2);T("aria-label",L(1,2,"download.portfolio")),s(2),g("nfts",t.selectedNfts())}}function Ot(i,r){if(i&1&&(c(0,"div",1)(1,"mat-chip-listbox"),V(2,Ft,6,8,"mat-chip",4,kt,!0),_(4,Lt,3,4,"mat-chip",5),m()()),i&2){let t=d();s(2),j(t.sortMethods),s(2),h(t.selectedNfts().length?4:-1)}}function Et(i,r){if(i&1&&(c(0,"div",10)(1,"span",12),P(2),m()()),i&2){let t=d().$implicit,e=d(2);s(2),rt(e.getOrderNumber(t))}}function Bt(i,r){if(i&1){let t=U();c(0,"mat-grid-tile",9),k("contextmenu",function(a){let n=b(t).$implicit,u=d(2);return C(u.toggleNftSelection(a,n))})("click",function(){let a=b(t).$implicit,n=d(2);return C(n.handleArtPieceClick(a.tokenId))}),c(1,"mat-card"),_(2,Et,3,1,"div",10),c(3,"img",11),k("visible",function(){let a=b(t).$implicit,n=d(2);return C(n.onImageVisible(a.tokenId))}),m()()()}if(i&2){let t,e=r.$implicit,a=d(2);T("aria-label",e.name),s(2),h(a.isSelected(e)?2:-1),s(),g("src",a.displayedImages.has(e.tokenId)&&(t=a.imgThumbUrls().get(e.tokenId))!==null&&t!==void 0?t:null,K)("alt","Artwork "+e.name)}}function Nt(i,r){if(i&1&&(c(0,"mat-grid-list",2),V(1,Bt,4,4,"mat-grid-tile",8,et().listTracking,!0),m()),i&2){let t=d();g("cols",t.numberOfCols()),s(),j(t.visibleArtPieces())}}function Vt(i,r){i&1&&z(0,"mat-progress-spinner",3)}var Le=(()=>{class i{constructor(){this.artworkInfraService=o(It),this.router=o(dt),this.activatedroute=o(ct),this.responsiveService=o(vt),this.sessionQuery=o(E),this.numberOfCols=A(this.responsiveService.displayMobileLayout.value?3:2),this.viewAsWidget=A(!1),this.nftFilters=A({}),this.selectedTokenId=Z(),this.sortMethods=Object.values(v),this.artPieces=ft(this.artworkInfraService.getArtPiecesObservable()),this.dataReady=O(()=>!!this.artPieces()?.length),this.activeSortMethod=x(v.YEAR),this.sortOrder=x(f.DESC),this.sortedArtPieces=O(()=>{switch(this.activeSortMethod()){case v.SIZE:return l.sortBySize(this.artPieces(),this.sortOrder());case v.MEDIUM:return l.sortByMedium(this.artPieces(),this.sortOrder());case v.YEAR:return l.sortByYear(this.artPieces(),this.sortOrder())}}),this.visibleArtPieces=O(()=>(this.sortedArtPieces()??[]).filter(t=>!this.isExcludedByYear(t)&&!this.isExcludedById(t)&&this.isMemoizedFrontalView(t))),this.displayedImages=new Set,this.imgThumbUrls=x(new Map),this.selectedNfts=x([]),this.frontalViewMap=new Map}ngOnInit(){this.listenYearParamChange()}onImageVisible(t){this.displayedImages.add(t);let e=this.artPieces()?.find(a=>a.tokenId===t);e&&this.loadImgThumbUrl(e)}loadImgThumbUrl(t){this.imgThumbUrls().has(t.tokenId)||this.artworkInfraService.getAvailableOptimalUrl(t).pipe(Y(1)).subscribe(e=>{this.imgThumbUrls.update(a=>{let n=new Map(a);return n.set(t.tokenId,e),n})})}toggleNftSelection(t,e){t.preventDefault();let a=this.selectedNfts(),n=a.findIndex(u=>u.tokenId===e.tokenId);if(n===-1)this.selectedNfts.set([...a,e]);else{let u=[...a];u.splice(n,1),this.selectedNfts.set(u)}}isSelected(t){return this.selectedNfts().some(e=>e.tokenId===t.tokenId)}getOrderNumber(t){let e=this.selectedNfts().findIndex(a=>a.tokenId===t.tokenId);return e!==-1?e+1:null}toggleSortOrder(){this.sortOrder.set(this.sortOrder()===f.ASC?f.DESC:f.ASC)}changeSortMethod(t){this.activeSortMethod()===t?this.toggleSortOrder():(this.activeSortMethod.set(t),this.sortOrder.set(f.ASC))}handleArtPieceClick(t){this.selectedTokenId.emit(t),this.router.navigate(["/artwork",t])}listTracking(t,e){return e}methodTracking(t){return t}isMemoizedFrontalView(t){if(this.frontalViewMap.has(t.tokenId))return this.frontalViewMap.get(t.tokenId)||!1;{let e=l.getArtByTitle(t.name,this.sessionQuery.selectArtPieces),a=l.isFrontalView(t,e);return this.frontalViewMap.set(t.tokenId,a),a}}listenYearParamChange(){this.router.events.pipe(G()).subscribe(()=>{if(this.activatedroute.firstChild){let t=this.activatedroute.firstChild.snapshot.queryParamMap.get("years");this.nftFilters().years=t?t.split(","):[]}else if(!this.activatedroute.snapshot.paramMap.get("id")){let t=this.activatedroute.snapshot.queryParamMap.get("years");this.nftFilters().years=t?t.split(","):[]}})}isExcludedById(t){return this.nftFilters()?.idsToExclude?.length?this.nftFilters().idsToExclude.includes(t.tokenId):!1}isExcludedByYear(t){return this.nftFilters().years?.length?!this.nftFilters().years.some(e=>t.raw.metadata.attributes?.some(a=>a.trait_type===gt.YEAR&&a.value===e)):!1}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-art-pieces-list"]],inputs:{numberOfCols:[1,"numberOfCols"],viewAsWidget:[1,"viewAsWidget"],nftFilters:[1,"nftFilters"]},outputs:{selectedTokenId:"selectedTokenId"},decls:4,vars:5,consts:[[3,"ngClass"],[1,"sort-group"],["gutterSize","10","rowHeight","1:1","role","list","aria-label","Art Pieces",3,"cols"],["diameter","48","mode","indeterminate","aria-label","Loading art pieces"],["color","primary","role","button",3,"matTooltip"],["role","button"],["color","primary","role","button",3,"click","matTooltip"],[3,"nfts"],["role","listitem"],["role","listitem",3,"contextmenu","click"],[1,"overlay"],["mat-card-image","","loading","lazy","appLazyLoad","",1,"front-image",3,"visible","src","alt"],[1,"order-number"]],template:function(e,a){e&1&&(c(0,"div",0),_(1,Ot,5,1,"div",1)(2,Nt,3,1,"mat-grid-list",2)(3,Vt,1,0,"mat-progress-spinner",3),m()),e&2&&(g("ngClass",nt(3,Tt,!a.viewAsWidget())),s(),h(a.viewAsWidget()?-1:1),s(),h(a.dataReady()?2:3))},dependencies:[ot,pt,lt,ut,xt,_t,bt,yt,Mt,Ct,wt,At,mt],styles:["mat-grid-tile[_ngcontent-%COMP%]{cursor:pointer}mat-card[_ngcontent-%COMP%]{position:relative;height:100%;width:100%;display:flex;align-items:stretch;justify-content:stretch}.container[_ngcontent-%COMP%]{margin-top:0}.sort-group[_ngcontent-%COMP%]{margin-bottom:2em}.sort-desc[_ngcontent-%COMP%]{margin-left:2em;align-items:center;display:flex}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.5em;z-index:1;pointer-events:none}.order-number[_ngcontent-%COMP%]{font-weight:700}"]})}}return i})();export{It as a,Le as b};
